    ## DEMO
    location = /demo {rewrite ^([^.]*[^/])$ $1/ permanent;}

    location ~* ^/demo/stomp {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/demo;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass    http://rabbitmq_web_stomp_server;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
     }

    location ~* ^/demo/(?!contexts|people|activities|conversations|admin|auth).*$ {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/demo;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/demo/(.*) /$1 break;

        proxy_pass    http://max.upcnet.es:11002;
     }

    location ~ ^/demo/(.*) {

        if ($request_method = 'OPTIONS') {

            # Tell client that this pre-flight info is valid for 20 days
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain charset=UTF-8';
            add_header 'Content-Length' 0;

            return 200;
        }

        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/demo;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/demo/(.*) /$1 break;

        proxy_pass   http://max.upcnet.es:10002;
    }

    ## BQDC
    location = /bqdc {rewrite ^([^.]*[^/])$ $1/ permanent;}

    location ~* ^/bqdc/stomp {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/demo;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass    http://rabbitmq_web_stomp_server;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
     }

    location ~* ^/bqdc/(?!contexts|people|activities|conversations|admin|auth).*$ {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/bqdc;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/bqdc/(.*) /$1 break;

        proxy_pass    http://max.upcnet.es:11003;
     }

    location ~ ^/bqdc/(.*) {

        if ($request_method = 'OPTIONS') {

            # Tell client that this pre-flight info is valid for 20 days
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain charset=UTF-8';
            add_header 'Content-Length' 0;

            return 200;
        }

        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/bqdc;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/bqdc/(.*) /$1 break;

        proxy_pass   http://max.upcnet.es:10003;
    }

    ## PARTNERS
    location = /partners {rewrite ^([^.]*[^/])$ $1/ permanent;}

    location ~* ^/partners/stomp {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/demo;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass    http://rabbitmq_web_stomp_server;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
     }

    location ~* ^/partners/(?!contexts|people|activities|conversations|admin|auth).*$ {
        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/partners;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/partners/(.*) /$1 break;

        proxy_pass    http://max.upcnet.es:11004;
     }

    location ~ ^/partners/(.*) {

        if ($request_method = 'OPTIONS') {

            # Tell client that this pre-flight info is valid for 20 days
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain charset=UTF-8';
            add_header 'Content-Length' 0;

            return 200;
        }

        proxy_set_header X-Virtual-Host-URI $scheme://max.upcnet.es/partners;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        rewrite ^/partners/(.*) /$1 break;

        proxy_pass   http://max.upcnet.es:10004;
    }
